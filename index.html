<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTIMATE –ö–µ–π—Å-–°–∏–º—É–ª—è—Ç–æ—Ä v6.1 (–§–∏–Ω–∞–ª—å–Ω—ã–π –î–∏–∑–∞–π–Ω)</title>
    
    <style>
        /* ================================================= */
        /* == 1. CSS: –û–±—â–∏–π –î–∏–∑–∞–π–Ω, –í–∫–ª–∞–¥–∫–∏ –∏ –ê–Ω–∏–º–∞—Ü–∏–∏   == */
        /* ================================================= */
        :root {
            --main-bg: #11111d; 
            --panel-bg: #1c1c36;
            --card-color: #2b2b4a;
            --accent-color: #00e5ff; 
            --hover-color: #00ffff;
            --shadow-color: rgba(0, 229, 255, 0.4);
            --item-size: 100px;
            --legendary-color: #ff00ff; 
            --rare-color: gold; 
            --epic-color: #9b59b6; 
            --currency-color: #2ecc71; 
            --ultra-color: #e74c3c; 
            --risk-color: #FFA500; 
            --quick-open-color: #3498db; 
            --sell-base: #e74c3c; 
            --sell-hover: #ff6347; 
        }

        body {
            background: var(--main-bg);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            min-height: 100vh;
            margin: 0;
            opacity: 0; 
            transition: opacity 1s ease-in-out;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–∏ */
        }
        
        /* –°–ö–†–´–¢–ê–Ø –í–ï–†–°–ò–Ø –í –£–ì–õ–£ */
        body::after {
            content: "v6.1";
            position: fixed;
            bottom: 5px;
            right: 10px;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.15); /* –ï–ª–µ –≤–∏–¥–Ω–æ */
            pointer-events: none;
        }

        body.loaded {
            opacity: 1;
        }

        .main-container {
            width: 1200px; 
            background: var(--panel-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            padding: 30px;
        }
        
        .logo {
            font-family: 'Impact', sans-serif;
            font-size: 2.5em;
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--shadow-color);
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .logo:hover {
            transform: scale(1.05);
        }

        h2 {
            color: var(--accent-color);
            border-bottom: 2px solid var(--card-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–í–∫–ª–∞–¥–∫–∏) */
        .tabs {
            display: flex;
            margin-bottom: 30px;
        }
        .tab-button {
            background: var(--card-color);
            border: none;
            padding: 15px 35px;
            color: #ccc;
            font-size: 1.1em;
            cursor: pointer;
            transition: color 0.3s, background 0.3s;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
        }
        .tab-button.active {
            background: #3e3e68;
            color: var(--accent-color);
            font-weight: bold;
            box-shadow: inset 0 3px 0 var(--accent-color);
        }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –í–ö–õ–ê–î–û–ö */
        .tab-content {
            display: none;
            padding: 20px 0;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
            min-height: 400px; 
        }
        .tab-content.active {
            display: block;
        }
        .tab-content.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* HEADER & BALANCE */
        .header-info {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            margin-bottom: 30px;
        }
        .balance-display {
            font-size: 1.8em;
            color: var(--rare-color);
            background: var(--card-color);
            padding: 10px 25px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        /* ==================== –°–µ–∫—Ü–∏—è –õ–æ–±–±–∏ –ö–µ–π—Å–æ–≤ ==================== */
        .case-lobby {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
        }

        .case-lobby-card {
            width: 250px;
            background: var(--card-color);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, opacity 0.5s;
            border: 2px solid transparent;
            opacity: 0; 
            animation: fadeInItem 0.5s ease-out forwards;
        }
        
        .case-lobby-card:nth-child(1) { animation-delay: 0s; }
        .case-lobby-card:nth-child(2) { animation-delay: 0.1s; }
        .case-lobby-card:nth-child(3) { animation-delay: 0.2s; }
        .case-lobby-card:nth-child(4) { animation-delay: 0.3s; }
        .case-lobby-card:nth-child(5) { animation-delay: 0.4s; }
        .case-lobby-card:nth-child(6) { animation-delay: 0.5s; }
        .case-lobby-card:nth-child(7) { animation-delay: 0.6s; }

        .case-lobby-card.fade-out {
            opacity: 0 !important;
            transform: scale(0.9);
        }

        .case-lobby-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), 0 0 10px var(--accent-color);
        }

        .case-lobby-card h3 {
            margin: 5px 0 10px 0;
            font-size: 1.4em;
        }

        .case-lobby-card .icon {
            font-size: 50px;
            margin-top: 10px;
        }

        /* –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –ª–æ–±–±–∏ */
        .case-lobby-card[data-case-id="currency"] { border-color: var(--currency-color); }
        .case-lobby-card[data-case-id="vip"] { border-color: var(--legendary-color); }
        .case-lobby-card[data-case-id="ultra"] { border-color: var(--ultra-color); }
        .case-lobby-card[data-case-id="chaos"] { border-color: var(--epic-color); }
        .case-lobby-card[data-case-id="cosmic"] { border-color: var(--rare-color); } 
        .case-lobby-card[data-case-id="risk"] { border-color: var(--risk-color); } 


        /* ==================== –î–µ—Ç–∞–ª—å–Ω—ã–π –í–∏–¥ –ö–µ–π—Å–∞ ==================== */
        .case-detail-view {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .case-detail-view.active {
            display: flex;
        }

        /* –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î (–£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω) */
        .case-detail-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        #back-to-lobby-btn {
            background: var(--card-color);
            color: white;
            border: 1px solid #4a4a75;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
            font-weight: bold;
        }
        #back-to-lobby-btn:hover {
            background: #3e3e68;
            transform: translateX(-5px) scale(1.05);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∞–º–∏ */
        #roll-area-container {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            min-height: 150px; 
        }
        
        .roll-area {
            width: 700px; 
            height: calc(var(--item-size) + 20px); 
            overflow: hidden; 
            position: relative;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.7);
        }
        
        .roll-area.small {
            width: 220px;
            height: 60px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
        }
        
        .roll-area::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            height: 100%;
            width: 6px;
            background: #ff4d4d; 
            z-index: 10;
            transform: translateX(-50%);
            box-shadow: 0 0 15px #ff4d4d;
        }

        .item-strip {
            position: absolute; left: 0; transition: transform 0s; display: flex; 
        }
        
        .item-strip.rolling-animate { transition: transform 4s cubic-bezier(0.1, 0.8, 0.3, 1); }

        /* –ö–ê–†–¢–û–ß–ö–ê –ü–†–ï–î–ú–ï–¢–ê */
        .item-card {
            min-width: var(--item-size);
            height: var(--item-size);
            background: #4a4a75;
            margin: 5px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.8em;
            text-align: center;
            user-select: none;
            flex-shrink: 0;
            border: 2px solid transparent;
            transition: box-shadow 0.3s;
        }

        /* –£–í–ï–õ–ò–ß–ï–ù–ò–ï –ò–ö–û–ù–ö–ò –î–õ–Ø –ë–û–õ–¨–®–û–ô –†–£–õ–ï–¢–ö–ò */
        .item-card .item-card-icon {
            font-size: 40px; 
            margin-bottom: 5px;
            line-height: 1;
        }

        /* –ê–î–ê–ü–¢–ê–¶–ò–Ø –î–õ–Ø –ú–ê–õ–ï–ù–¨–ö–û–ô –†–£–õ–ï–¢–ö–ò (x10) */
        .roll-area.small .item-strip { top: -20px; }
        .roll-area.small .item-strip .item-card { min-width: 60px; height: 60px; margin: 0 2px; padding: 0; justify-content: center; font-size: 0.6em; line-height: 1.1; }
        .roll-area.small .item-strip .item-card .item-card-icon { font-size: 25px; margin-bottom: 0; }
        
        /* ==================== –ü–û–î–°–í–ï–¢–ö–ê –†–ï–î–ö–û–°–¢–ò ==================== */

        /* –†–µ–¥–∫–∏–µ –∏–∫–æ–Ω–∫–∏/–∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –∏ —à–∞–Ω—Å–∞—Ö */
        .inventory-item.rare, 
        .chance-item.rare .rarity-name,
        .item-card.rare {
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.6), 0 0 4px var(--rare-color);
        }
        
        .inventory-item.epic,
        .chance-item.epic .rarity-name,
        .item-card.epic {
            box-shadow: 0 0 12px rgba(155, 89, 182, 0.7), 0 0 4px var(--epic-color);
        }
        
        .inventory-item.legendary,
        .chance-item.legendary .rarity-name,
        .item-card.legendary {
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.8), 0 0 5px var(--legendary-color);
        }

        .inventory-item.ultra,
        .chance-item.ultra .rarity-name,
        .item-card.ultra {
            box-shadow: 0 0 18px rgba(231, 76, 60, 0.9), 0 0 6px var(--ultra-color);
            animation: ultraGlow 1s infinite alternate;
        }

        @keyframes ultraGlow {
            0% { box-shadow: 0 0 10px var(--ultra-color); }
            100% { box-shadow: 0 0 25px var(--ultra-color), 0 0 5px #fff; }
        }

        /* ==================== –≠–§–§–ï–ö–¢ –ë–õ–ï–°–ö–ê –ö–ù–û–ü–û–ö –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï ==================== */
        .case-buttons-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 700px; 
        }
        
        .quick-open-toggle-container {
            margin-bottom: 15px;
            background: var(--card-color);
            padding: 8px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            border: 1px solid #4a4a75;
            transition: box-shadow 0.3s;
        }
        
        .quick-open-toggle-container:hover {
            box-shadow: 0 0 10px var(--accent-color);
        }

        .case-buttons-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }

        .open-case-btn {
            position: relative; 
            overflow: hidden;
            z-index: 1; 
            
            background: var(--accent-color);
            color: var(--main-bg);
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
            box-shadow: 0 5px 15px var(--shadow-color);
            
            width: 30%; 
        }
        
        .open-case-btn.pack-open-btn {
            background: var(--currency-color);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.5);
        }

        .open-case-btn:hover {
            transform: scale(1.03); 
        }
        
        /* –ë–õ–ï–°–ö */
        .open-case-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -200%; 
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to right, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(255, 255, 255, 0.5) 50%, 
                rgba(255, 255, 255, 0) 100%
            );
            transform: skewX(-20deg); 
            transition: all 0.3s;
            z-index: 2;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –ë–õ–ï–°–ö–ê */
        .open-case-btn:hover::after {
            left: 200%; 
            transition: all 0.7s cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        .open-case-btn:disabled { background: #555; cursor: not-allowed; box-shadow: none; transform: scale(1); }


        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è */
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; margin-left: 10px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:focus + .slider { box-shadow: 0 0 1px var(--accent-color); }
        input:checked + .slider:before { transform: translateX(20px); }
        
        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å: –ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ */
        #sell-all-btn {
            background: #cc4444;
            box-shadow: 0 4px 10px rgba(204, 68, 68, 0.5);
            transition: background 0.3s, transform 0.2s;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            margin-left: 20px;
        }
        #sell-all-btn:hover {
            background: #ff5555;
            transform: scale(1.05);
        }


        /* ... –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ ... */
        .common { background: linear-gradient(135deg, #444, #333); color: #ccc; }
        .rare { background: linear-gradient(135deg, #7d7d00, #4a4a75); color: var(--rare-color); }
        .epic { background: linear-gradient(135deg, #5f3c5f, #4a4a75); color: var(--epic-color); }
        .legendary { background: radial-gradient(circle at 70% 30%, #ff00ff, #3c5f5f); color: var(--legendary-color); }
        .ultra { background: radial-gradient(circle at 70% 30%, #e74c3c, #3c235f); color: var(--ultra-color); }
        #notification-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .notification { background: #2ecc71; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); margin-bottom: 10px; opacity: 0; transform: translateX(100%); transition: opacity 0.5s ease-out, transform 0.5s ease-out; max-width: 300px; font-weight: 500; display: flex; justify-content: space-between; align-items: center; }
        .notification .count { background: rgba(0, 0, 0, 0.2); padding: 2px 8px; border-radius: 50%; margin-left: 10px; font-size: 0.9em; font-weight: bold; }
        .notification.error { background: #e74c3c; }
        .notification.show { opacity: 1; transform: translateX(0); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--panel-bg); padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7); text-align: center; transform: scale(0.8); opacity: 0; transition: all 0.3s ease-in-out; max-width: 400px; }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
        .modal-buttons button { padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #confirm-sell-btn { background: var(--sell-base); color: white; }
        #cancel-sell-btn { background: #555; color: white; }
        .inventory-top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 10px; }
        .inventory-list { display: flex; flex-wrap: wrap; gap: 20px; padding: 10px; }
        .inventory-item { width: 140px; background: var(--card-color); border-radius: 10px; padding: 10px; display: flex; flex-direction: column; align-items: center; text-align: center; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); opacity: 0; transform: translateY(10px); animation: fadeInItem 0.5s ease-out forwards; }
        @keyframes fadeInItem { to { opacity: 1; transform: translateY(0); } }
        .sell-btn { background: var(--sell-base); color: white; border: none; padding: 8px 15px; margin-top: 10px; border-radius: 5px; cursor: pointer; font-size: 0.9em; width: 100%; transition: background 0.3s ease-in-out, box-shadow 0.3s ease-in-out; }
        .sell-btn:hover { background: var(--sell-hover); box-shadow: 0 0 15px rgba(255, 99, 71, 0.8); }
        #corner-overlay { position: fixed; top: 20px; left: 20px; width: 250px; height: 120px; background: rgba(43, 43, 74, 0.7); backdrop-filter: blur(5px); border-radius: 15px; padding: 15px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); color: #ddd; font-size: 0.9em; z-index: 50; border: 1px solid #4a4a75; transition: opacity 0.5s ease-in-out; }
        #corner-overlay h4 { margin: 0 0 5px 0; color: var(--accent-color); }
        
    </style>
</head>
<body class="loaded">
    <div class="modal-overlay" id="sell-modal-overlay">
        <div class="modal-content">
            <h3 style="color: #ff4d4d;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏</h3>
            <p id="modal-sell-text"></p>
            <div class="modal-buttons">
                <button id="confirm-sell-btn">–ü—Ä–æ–¥–∞—Ç—å</button>
                <button id="cancel-sell-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <div id="notification-container"></div>
    
    <div class="header-info">
        <div id="balance" class="balance-display">1000 üíé</div>
    </div>

    <div class="main-container">
        <div class="logo" id="main-logo">CASE SIMULATOR V6.1</div>
        
        <div class="tabs">
            <button class="tab-button" data-tab="cases">–ö–µ–π—Å—ã</button>
            <button class="tab-button" data-tab="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="tab-button" data-tab="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        </div>

        <div id="cases" class="tab-content case-section">
            
            <div id="case-lobby-view" class="case-detail-view">
                <h2>–í—ã–±–æ—Ä –ö–µ–π—Å–∞</h2>
                <div class="case-lobby">
                    <div class="case-lobby-card" data-case-id="basic">
                        <div class="icon">üì¶</div>
                        <h3>–ê—Ä—Ç–µ—Ñ–∞–∫—Ç –°—É–¥—å–±—ã</h3>
                        <p class="price">100 üíé</p>
                    </div>
                    
                    <div class="case-lobby-card" data-case-id="chaos">
                        <div class="icon" style="color: var(--epic-color);">‚ö°</div>
                        <h3 style="color: var(--epic-color);">–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –•–∞–æ—Å</h3>
                        <p class="price">500 üíé</p>
                    </div>
                    
                    <div class="case-lobby-card" data-case-id="vip">
                        <div class="icon" style="color: var(--legendary-color);">üîÆ</div>
                        <h3 style="color: var(--legendary-color);">VIP-–≠–ª–∏—Ç–Ω—ã–π</h3>
                        <p class="price">1000 üíé</p>
                    </div>

                    <div class="case-lobby-card" data-case-id="currency">
                        <div class="icon" style="color: var(--currency-color);">üíµ</div>
                        <h3 style="color: var(--currency-color);">–í–∞–ª—é—Ç–Ω—ã–π –ö–ª–æ–Ω–¥–∞–π–∫</h3>
                        <p class="price">2500 üíé</p>
                    </div>
                    
                    <div class="case-lobby-card" data-case-id="ultra">
                        <div class="icon" style="color: var(--ultra-color);">üíÄ</div>
                        <h3 style="color: var(--ultra-color);">–£–ª—å—Ç—Ä–∞ –°–º–µ—Ä—Ç–∏</h3>
                        <p class="price">5000 üíé</p>
                    </div>
                    
                    <div class="case-lobby-card" data-case-id="cosmic">
                        <div class="icon" style="color: var(--rare-color);">üåå</div>
                        <h3 style="color: var(--rare-color);">–ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ù–∞—Å–ª–µ–¥–∏–µ</h3>
                        <p class="price">7500 üíé</p>
                    </div>
                    
                    <div class="case-lobby-card" data-case-id="risk">
                        <div class="icon" style="color: var(--risk-color);">‚ö†Ô∏è</div>
                        <h3 style="color: var(--risk-color);">–í—Å—ë –∏–ª–∏ –ù–∏—á–µ–≥–æ</h3>
                        <p class="price">10000 üíé</p>
                    </div>
                    
                </div>
            </div>

            <div id="case-detail-view" class="case-detail-view">
                <div class="case-detail-header">
                    <button id="back-to-lobby-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É</button>
                    <h2 id="detail-case-name"></h2>
                    <span></span>
                </div>
                
                <div id="roll-area-container">
                    </div>

                <div class="case-buttons-controls">
                    <div class="quick-open-toggle-container">
                        <label for="quick-open-toggle">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ (–±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏):</label>
                        <label class="switch">
                          <input type="checkbox" id="quick-open-toggle">
                          <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="case-buttons-group">
                        <button class="open-case-btn" data-type="animated" data-amount="1">–û—Ç–∫—Ä—ã—Ç—å 1</button>
                        <button class="open-case-btn pack-open-btn" data-type="animated" data-amount="10">–û—Ç–∫—Ä—ã—Ç—å x10</button>
                    </div>
                </div>
                
                <div id="status-message" style="margin-top: 35px; font-style: italic; font-size: 1.1em;"></div>

                <div class="case-info">
                    <div class="chances-list">
                        <h4>–®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è:</h4>
                        <div id="chances-content"></div>
                    </div>
                    <div class="chances-list">
                        <h4>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞:</h4>
                        <div id="items-content"></div>
                    </div>
                </div>

            </div>
        </div>

        <div id="inventory" class="tab-content">
            <div class="inventory-top-bar">
                <h2>–í–∞—à–∏ –ü—Ä–µ–¥–º–µ—Ç—ã</h2>
                <div>
                    <button id="sell-all-btn" class="open-case-btn" style="width: auto; margin: 0; box-shadow: none;">–ü—Ä–æ–¥–∞—Ç—å –í—Å—ë</button>
                    <div class="toggle-switch-container" style="display: inline-flex; margin-left: 20px;">
                        <label for="sell-confirm-toggle">–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞:</label>
                        <label class="switch">
                          <input type="checkbox" id="sell-confirm-toggle">
                          <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div id="inventory-list" class="inventory-list">
                <p style="padding: 20px;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–µ–π—Å!</p>
            </div>
        </div>
        
        <div id="shop" class="tab-content" style="text-align: center;">
            <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
            <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–π –±–∞–ª–∞–Ω—Å.</p>
            <button id="add-balance-btn" class="buy-button" style="margin-top: 20px; background: #2ecc71; width: 300px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å (+500 üíé)</button>
        </div>

    </div>


    <script type="module">
        // ===================================================
        // == FIREBASE –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ò–ú–ü–û–†–¢–´              ==
        // ===================================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBTcH3_tri2L7AHLh1e-YD-0s-QSthuE6Q",
            authDomain: "disk-c98ee.firebaseapp.com",
            projectId: "disk-c98ee",
            storageBucket: "disk-c98ee.appspot.com",
            messagingSenderId: "59577059636",
            appId: "1:59577059636:web:e98f456d054cc360747d61",
            databaseURL: "https://disk-c98ee-default-rtdb.firebaseio.com"
        };
        
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const USER_ID = "guest_user_123";
        
        // --- –§–£–ù–ö–¶–ò–ò –ë–ê–ó–´ –î–ê–ù–ù–´–• (DB) ---
        
        async function loadUserData() {
            try {
                const snapshot = await get(ref(database, 'users/' + USER_ID));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    return {
                        balance: data.balance || 1000,
                        inventory: Array.isArray(data.inventory) ? data.inventory : (data.inventory ? Object.values(data.inventory) : [])
                    };
                } else {
                    return { balance: 1000, inventory: [] };
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase:", error);
                return { balance: 1000, inventory: [] }; 
            }
        }
        
        function saveUserData(currentBalance, currentInventory) {
            set(ref(database, 'users/' + USER_ID), {
                balance: currentBalance,
                inventory: currentInventory 
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Firebase:", error);
            });
        }

        // ===================================================
        // == –û–°–ù–û–í–ù–û–ô –ö–û–î –°–ò–ú–£–õ–Ø–¢–û–†–ê                       ==
        // ===================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            const balanceDisplay = document.getElementById('balance');
            const inventoryList = document.getElementById('inventory-list');
            const statusMessage = document.getElementById('status-message');
            const addBalanceBtn = document.getElementById('add-balance-btn');
            const sellConfirmToggle = document.getElementById('sell-confirm-toggle');
            const quickOpenToggle = document.getElementById('quick-open-toggle'); 
            const sellAllBtn = document.getElementById('sell-all-btn');
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const notificationContainer = document.getElementById('notification-container');
            const totalItemsDisplay = document.getElementById('total-items');
            const mainLogo = document.getElementById('main-logo');
            
            const caseLobbyView = document.getElementById('case-lobby-view');
            const caseDetailView = document.getElementById('case-detail-view');
            const backToLobbyBtn = document.getElementById('back-to-lobby-btn');
            const detailCaseName = document.getElementById('detail-case-name');
            const chancesContent = document.getElementById('chances-content');
            const itemsContent = document.getElementById('items-content');
            const rollAreaContainer = document.getElementById('roll-area-container');
            const detailOpenButtons = caseDetailView.querySelectorAll('.open-case-btn');

            const sellModalOverlay = document.getElementById('sell-modal-overlay');
            const modalSellText = document.getElementById('modal-sell-text');
            const confirmSellBtn = document.getElementById('confirm-sell-btn');
            const cancelSellBtn = document.getElementById('cancel-sell-btn');
            let itemToSell = null; 
            
            const ANIMATION_DURATION = 4000; 
            const FINAL_PAUSE_DURATION = 1000; 
            const ITEM_WIDTH = 110; 

            // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ ---
            let balance = 0; 
            const INVENTORY = []; 
            let CURRENT_CASE_ID = null;

            const ALL_ITEMS = [
                // COMMON ITEMS (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å–∫–ª–µ–π–∫–∏)
                { id: 1, name: "–û–±—ã—á–Ω—ã–π –ö–∞–º–µ–Ω—å", rarity: 30, icon: '‚ö™', class: 'common', sell: 10 },
                { id: 2, name: "–†–∂–∞–≤—ã–π –ö–ª—é—á", rarity: 25, icon: 'üîë', class: 'common', sell: 15 },
                { id: 3, name: "–†–µ–¥–∫–∞—è –Ø—á–µ–π–∫–∞", rarity: 25, icon: 'üîã', class: 'rare', sell: 50 },
                { id: 4, name: "–≠–ø–∏—á–µ—Å–∫–∏–π –ö—Ä–∏—Å—Ç–∞–ª–ª", rarity: 15, icon: 'üíé', class: 'epic', sell: 150 },
                { id: 5, name: "–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô –ê—Ä—Ç–µ—Ñ–∞–∫—Ç", rarity: 5, icon: '‚ú®', class: 'legendary', sell: 500 },
                
                // BASIC
                { id: 1, case: 'basic' }, { id: 2, case: 'basic' }, { id: 3, case: 'basic' }, { id: 4, case: 'basic' }, { id: 5, case: 'basic' },

                // CHAOS (–ù–æ–≤—ã–π - –≠–ø–∏—á–µ—Å–∫–∏–π —Ñ–æ–∫—É—Å)
                { id: 2, case: 'chaos', rarity: 15 },
                { id: 3, case: 'chaos', rarity: 30 },
                { id: 4, case: 'chaos', rarity: 40 },
                { id: 5, case: 'chaos', rarity: 15 },

                // VIP
                { id: 6, name: "–†–µ–¥–∫–∏–π VIP –ö–ª—é—á", rarity: 30, icon: 'üîë', class: 'rare', sell: 150, case: 'vip' },
                { id: 7, name: "–≠–ø–∏—á–µ—Å–∫–∏–π –°–≤–∏—Ç–æ–∫", rarity: 40, icon: 'üìú', class: 'epic', sell: 500, case: 'vip' },
                { id: 8, name: "–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô –ö–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä", rarity: 25, icon: '‚öõÔ∏è', class: 'legendary', sell: 1200, case: 'vip' },
                { id: 9, name: "–ú–ò–§–ò–ß–ï–°–ö–ò–ô –ñ–µ–∑–ª –í–ª–∞—Å—Ç–∏", rarity: 5, icon: 'üëë', class: 'legendary', sell: 5000, case: 'vip' },

                // CURRENCY
                { id: 10, name: "100 üíé", rarity: 50, icon: 'üí∏', class: 'common', sell: 100, case: 'currency' },
                { id: 11, name: "500 üíé", rarity: 30, icon: 'üíµ', class: 'rare', sell: 500, case: 'currency' },
                { id: 12, name: "2000 üíé", rarity: 15, icon: 'üí∞', class: 'epic', sell: 2000, case: 'currency' },
                { id: 13, name: "10000 üíé", rarity: 5, icon: 'ü™ô', class: 'legendary', sell: 10000, case: 'currency' },

                // ULTRA
                { id: 14, name: "–ö—Ä–∏—Å—Ç–∞–ª–ª –≠–ø–æ—Ö", rarity: 40, icon: 'üî¥', class: 'epic', sell: 1000, case: 'ultra' },
                { id: 15, name: "–ß–µ—Ä–Ω–∞—è –ú–∞—Ç–µ—Ä–∏—è", rarity: 30, icon: '‚ö´', class: 'legendary', sell: 5000, case: 'ultra' },
                { id: 16, name: "–Ø–¥—Ä–æ –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏", rarity: 25, icon: '‚ôæÔ∏è', class: 'legendary', sell: 15000, case: 'ultra' },
                { id: 17, name: "–£–ª—å—Ç—Ä–∞-–®–ª–µ–º –°—É–¥—å–±—ã", rarity: 5, icon: 'üõ°Ô∏è', class: 'ultra', sell: 50000, case: 'ultra' },
                
                // COSMIC (–ì–∞—Ä–∞–Ω—Ç–∏—è –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö+)
                { id: 15, case: 'cosmic', rarity: 35 }, 
                { id: 16, case: 'cosmic', rarity: 45 }, 
                { id: 17, case: 'cosmic', rarity: 20 }, 
                
                // RISK (–í—Å–µ –∏–ª–∏ –ù–∏—á–µ–≥–æ)
                { id: 18, name: "–ü—É—Å—Ç–æ–π –§–∞–Ω—Ç–æ–º", rarity: 95, icon: 'üëª', class: 'common', sell: 0, case: 'risk' },
                { id: 19, name: "–î–∂–µ–∫–ø–æ—Ç (x5 –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤)", rarity: 5, icon: 'üé∞', class: 'ultra', sell: 50000, case: 'risk' },
            ];
            
            const ITEM_PROPERTIES = ALL_ITEMS.filter(item => item.name);

            const CASES = {
                basic: { name: '–ê—Ä—Ç–µ—Ñ–∞–∫—Ç –°—É–¥—å–±—ã', price: 100, icon: 'üì¶' },
                chaos: { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –•–∞–æ—Å', price: 500, icon: '‚ö°' },
                vip: { name: 'VIP-–≠–ª–∏—Ç–Ω—ã–π', price: 1000, icon: 'üîÆ' },
                currency: { name: '–í–∞–ª—é—Ç–Ω—ã–π –ö–ª–æ–Ω–¥–∞–π–∫', price: 2500, icon: 'üíµ' },
                ultra: { name: '–£–ª—å—Ç—Ä–∞ –°–º–µ—Ä—Ç–∏', price: 5000, icon: 'üíÄ' },
                cosmic: { name: '–ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ù–∞—Å–ª–µ–¥–∏–µ', price: 7500, icon: 'üåå' },
                risk: { name: '–í—Å—ë –∏–ª–∏ –ù–∏—á–µ–≥–æ', price: 10000, icon: '‚ö†Ô∏è' }
            };

            // --- –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê –ò –õ–û–ì–ò–ö–ò (—Å–æ–∫—Ä–∞—â–µ–Ω—ã) ---
            
            // –§–ò–ö–°: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–∞ (–û–ë–™–ï–î–ò–ù–ï–ù–ò–ï)
            function getItemFullData(itemRef) {
                const itemProps = ITEM_PROPERTIES.find(p => p.id === itemRef.id);
                // –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –¥–ª—è –∫–µ–π—Å–∞ rarity –∏ class –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç –æ–±—â–∏–µ, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç –≤—Å–µ –¥—Ä—É–≥–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ (name, icon, sell).
                return { ...itemProps, ...itemRef }; 
            }

            function showNotification(message, type = 'success', duration = 3000) {
                const cleanMessage = message.split(' x')[0];
                const existingNote = Array.from(notificationContainer.children).find(note => note.textContent.startsWith(cleanMessage));

                if (existingNote) {
                    let count = parseInt(existingNote.dataset.count || 1) + 1;
                    existingNote.dataset.count = count;
                    let span = existingNote.querySelector('.count');
                    if (!span) { span = document.createElement('span'); span.className = 'count'; existingNote.appendChild(span); }
                    span.textContent = `x${count}`;
                    clearTimeout(existingNote.timer);
                    existingNote.timer = setTimeout(() => { existingNote.classList.remove('show'); setTimeout(() => { existingNote.remove(); }, 500); }, duration);
                    return;
                }
                
                const note = document.createElement('div');
                note.className = `notification ${type}`;
                note.textContent = cleanMessage; 
                note.dataset.count = 1;
                notificationContainer.prepend(note);
                setTimeout(() => { note.classList.add('show'); }, 10); 
                note.timer = setTimeout(() => {
                    note.classList.remove('show');
                    setTimeout(() => { note.remove(); }, 500); 
                }, duration);
            }

            function updateBalance() {
                balanceDisplay.textContent = `${balance} üíé`;
                saveUserData(balance, INVENTORY); // –°–û–•–†–ê–ù–ï–ù–ò–ï: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
            }

            function updateInventoryCount() {
                totalItemsDisplay.textContent = `–ü—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ: ${INVENTORY.length}`;
            }

            function renderInventory() {
                inventoryList.innerHTML = ''; 
                if (INVENTORY.length === 0) {
                    inventoryList.innerHTML = '<p style="width: 100%; text-align: center; padding: 20px;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–µ–π—Å!</p>';
                    updateInventoryCount();
                    return;
                }

                INVENTORY.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = `inventory-item ${item.class}`;
                    itemElement.style.animationDelay = `${index * 0.05}s`; 
                    itemElement.innerHTML = `<div class="item-card-icon">${item.icon}</div><div class="item-name">${item.name}</div><button class="sell-btn" data-unique-id="${item.uniqueId}">–ü—Ä–æ–¥–∞—Ç—å –∑–∞ ${item.sell} üíé</button>`;
                    inventoryList.appendChild(itemElement);
                });

                inventoryList.querySelectorAll('.sell-btn').forEach(button => {
                    button.addEventListener('click', prepareSellItem);
                });
                
                updateInventoryCount();
            }

            // –ö–ù–û–ü–ö–ê –ü–†–û–î–ê–¢–¨ –í–°–Å
            sellAllBtn.addEventListener('click', sellAllItems);
            
            function sellAllItems() {
                if (INVENTORY.length === 0) {
                    showNotification("–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç!", 'error');
                    return;
                }
                
                let totalSold = 0;
                let totalValue = 0;
                
                INVENTORY.forEach(item => {
                    totalValue += item.sell;
                    totalSold++;
                });
                
                balance += totalValue;
                INVENTORY.length = 0; 
                
                updateBalance(); 
                renderInventory();
                showNotification(`–ü—Ä–æ–¥–∞–Ω–æ ${totalSold} –ø—Ä–µ–¥–º–µ—Ç–æ–≤. (+${totalValue} üíé)`, 'success', 5000);
            }
            // /–ö–ù–û–ü–ö–ê –ü–†–û–î–ê–¢–¨ –í–°–Å

            function prepareSellItem(event) {
                const uniqueId = event.target.dataset.uniqueId;
                const indexToRemove = INVENTORY.findIndex(item => item.uniqueId === parseFloat(uniqueId));
                if (indexToRemove === -1) return;
                itemToSell = INVENTORY[indexToRemove]; 
                if (sellConfirmToggle.checked) { performSell(); } 
                else { modalSellText.innerHTML = `–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø—Ä–æ–¥–∞—Ç—å **<span style="color: ${itemToSell.class === 'legendary' ? 'var(--legendary-color)' : itemToSell.class === 'rare' || itemToSell.class === 'epic' ? 'var(--rare-color)' : 'white'};">${itemToSell.name}</span>** –∑–∞ ${itemToSell.sell} üíé. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`; sellModalOverlay.classList.add('active'); }
            }

            function performSell() {
                const indexToRemove = INVENTORY.findIndex(item => item.uniqueId === itemToSell.uniqueId);
                if (indexToRemove !== -1) {
                    balance += itemToSell.sell;
                    INVENTORY.splice(indexToRemove, 1); 
                    updateBalance(); 
                    renderInventory();
                    showNotification(`–ü—Ä–æ–¥–∞–Ω–æ: ${itemToSell.name} (+${itemToSell.sell} üíé)`, 'success');
                }
                itemToSell = null; 
                sellModalOverlay.classList.remove('active');
            }
            
            confirmSellBtn.addEventListener('click', performSell);
            cancelSellBtn.addEventListener('click', () => {
                sellModalOverlay.classList.remove('active');
                itemToSell = null;
            });
            
            function getRandomItem(caseId) {
                const caseItemsRaw = ALL_ITEMS.filter(item => item.case === caseId);
                const caseItems = caseItemsRaw.map(getItemFullData);
                
                const totalRarity = caseItems.reduce((sum, item) => sum + item.rarity, 0);
                let randomNumber = Math.random() * totalRarity;

                for (const item of caseItems) {
                    randomNumber -= item.rarity;
                    if (randomNumber <= 0) { return item; }
                }
                return caseItems[0];
            }

            function generateStrip(itemStripElement, winningItem, isSmall = false) {
                itemStripElement.innerHTML = '';
                
                const stripItems = [];
                for (let i = 0; i < 50; i++) { stripItems.push(getRandomItem(winningItem.case)); }
                stripItems.push(winningItem); 
                for (let i = 0; i < 50; i++) { stripItems.push(getRandomItem(winningItem.case)); }
                
                stripItems.forEach(item => { itemStripElement.appendChild(createItemCard(item, isSmall)); });
            }

            function createItemCard(item, isSmall = false) {
                const card = document.createElement('div');
                card.className = `item-card ${item.class}`;
                card.innerHTML = `<div class="item-card-icon">${item.icon}</div>${isSmall ? '' : item.name}`; 
                return card;
            }
            
            // --- –õ–û–ì–ò–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í–ò–î–û–ú ---

            function goToLobby() {
                caseDetailView.classList.remove('visible'); 
                
                setTimeout(() => {
                    caseDetailView.classList.remove('active');
                    caseLobbyView.classList.add('active');
                    caseLobbyView.classList.add('visible'); 
                    CURRENT_CASE_ID = null;
                    statusMessage.textContent = '';
                }, 400); 
            }

            function renderCaseDetails(caseId) {
                CURRENT_CASE_ID = caseId;
                const caseData = CASES[caseId];
                const caseItems = ALL_ITEMS.filter(item => item.case === caseId).map(getItemFullData);
                const totalRarity = caseItems.reduce((sum, item) => sum + item.rarity, 0);

                rollAreaContainer.innerHTML = '';
                const singleRollArea = createRollAreaElement(caseId, false);
                rollAreaContainer.appendChild(singleRollArea);
                
                detailCaseName.textContent = caseData.name;

                detailOpenButtons.forEach(button => {
                    const amount = parseInt(button.dataset.amount);
                    const cost = amount * caseData.price;
                    button.textContent = `–û—Ç–∫—Ä—ã—Ç—å ${amount === 1 ? '' : 'x'}${amount} (${cost} üíé)`;
                    button.dataset.price = cost;
                    button.dataset.caseId = caseId;
                });
                
                // –®–∞–Ω—Å—ã
                chancesContent.innerHTML = caseItems.map(item => {
                    const chance = ((item.rarity / totalRarity) * 100).toFixed(2);
                    return `<div class="chance-item ${item.class}"><span class="rarity-name">${item.name}</span><span>${chance}%</span></div>`;
                }).join('');
                
                // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ
                itemsContent.innerHTML = caseItems.map(item => `<div class="inventory-item ${item.class}" style="width: 100px; height: 120px; margin-bottom: 10px;"><div class="item-card-icon">${item.icon}</div><div class="item-name">${item.name}</div><div style="font-size: 0.8em; color: var(--rare-color);">–ü—Ä–æ–¥–∞—Ç—å: ${item.sell} üíé</div></div>`).join('');


                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞ (—Å –ø–ª–∞–≤–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º)
                const caseLobbyCards = document.querySelectorAll('.case-lobby-card');
                caseLobbyCards.forEach(card => card.classList.add('fade-out'));

                setTimeout(() => {
                    caseLobbyView.classList.remove('active');
                    caseLobbyView.classList.remove('visible'); 
                    caseLobbyCards.forEach(card => card.classList.remove('fade-out')); 

                    caseDetailView.classList.add('active');
                    setTimeout(() => {
                        caseDetailView.classList.add('visible'); 
                    }, 50);
                }, 400); 

                // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏
                const itemStripElement = singleRollArea.querySelector('.item-strip');
                const dummyItem = getRandomItem(caseId);
                generateStrip(itemStripElement, dummyItem, false);
            }
            
            function createRollAreaElement(caseId, isSmall) {
                const rollArea = document.createElement('div');
                rollArea.className = `roll-area ${isSmall ? 'small' : ''}`;
                rollArea.dataset.caseId = caseId;
                
                const strip = document.createElement('div');
                strip.className = 'item-strip';
                
                rollArea.appendChild(strip);
                return rollArea;
            }
            
            // --- –õ–û–ì–ò–ö–ê –û–¢–ö–†–´–¢–ò–Ø (–ü–∞–∫–µ—Ç—ã –∏ –û–¥–∏–Ω–æ—á–Ω—ã–µ) ---
            
            function handleOpenCase(event) {
                const button = event.target;
                const caseId = button.dataset.caseId;
                let type = button.dataset.type; // animated –∏–ª–∏ quick
                const amount = parseInt(button.dataset.amount);
                const caseData = CASES[caseId];
                const totalCost = parseInt(button.dataset.price);

                if (balance < totalCost) {
                    showNotification(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è x${amount} (${totalCost} üíé)!`, 'error');
                    return;
                }
                
                // --- –°–ü–ò–°–ê–ù–ò–ï –í–ê–õ–Æ–¢–´ –ò –ü–†–û–í–ï–†–ö–ê TOGGLE ---
                balance -= totalCost;
                updateBalance();
                
                // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π toggle –ò —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ
                if (quickOpenToggle.checked && amount === 1) {
                    type = 'quick';
                }
                // --- –ö–û–ù–ï–¶ –§–ò–ö–°–ê ---


                if (amount > 1 && type === 'animated') {
                    openAnimatedPack(caseId, amount);
                } else if (amount > 1 || type === 'quick') {
                    openQuickPack(caseId, amount);
                } else {
                    openSingleCase(caseId, type);
                }
            }

            function openSingleCase(caseId, type) {
                document.querySelectorAll('.open-case-btn').forEach(btn => btn.disabled = true);
                
                const winningItemRaw = getRandomItem(caseId);
                const winningItem = getItemFullData(winningItemRaw); 
                
                if (type === 'quick') {
                    statusMessage.textContent = `–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞ "${CASES[caseId].name}"...`;
                    setTimeout(() => {
                        completeCaseOpening([winningItem]);
                    }, 500); 
                } else {
                    statusMessage.textContent = `–ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–µ–π—Å–∞ "${CASES[caseId].name}" –∑–∞–ø—É—â–µ–Ω–∞...`;
                    const rollArea = rollAreaContainer.querySelector('.roll-area');
                    runAnimatedOpening(rollArea, winningItem);
                }
            }
            
            // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞—á–∫–∏ (10 —Ä—É–ª–µ—Ç–æ–∫)
            function openAnimatedPack(caseId, amount) {
                document.querySelectorAll('.open-case-btn').forEach(btn => btn.disabled = true);
                statusMessage.textContent = `–ó–∞–ø—É—Å–∫–∞–µ–º ${amount} —Ä—É–ª–µ—Ç–æ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!`;
                
                rollAreaContainer.innerHTML = '';
                let winningItems = [];
                let rollPromises = [];
                
                for (let i = 0; i < amount; i++) {
                    const winningItemRaw = getRandomItem(caseId);
                    const winningItem = getItemFullData(winningItemRaw); 
                    winningItems.push(winningItem);
                    
                    const rollArea = createRollAreaElement(caseId, true); // –°–æ–∑–¥–∞–µ–º –º–∞–ª–µ–Ω—å–∫—É—é —Ä—É–ª–µ—Ç–∫—É
                    rollAreaContainer.appendChild(rollArea);
                    
                    rollPromises.push(new Promise(resolve => {
                        setTimeout(() => {
                            runAnimatedOpening(rollArea, winningItem, true, resolve);
                        }, i * 50); 
                    }));
                }
                
                // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö 10 –∞–Ω–∏–º–∞—Ü–∏–π
                Promise.all(rollPromises).then(() => {
                    // –î–∞–µ–º 1 —Å–µ–∫—É–Ω–¥—É –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    setTimeout(() => {
                        completeCaseOpening(winningItems);
                    }, FINAL_PAUSE_DURATION); 
                });
            }

            // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ë—ã—Å—Ç—Ä–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞—á–∫–∏
            function openQuickPack(caseId, amount) {
                let winningItems = [];
                
                for (let i = 0; i < amount; i++) {
                    const winningItemRaw = getRandomItem(caseId);
                    const winningItem = getItemFullData(winningItemRaw); 
                    winningItems.push(winningItem);
                }
                
                rollAreaContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º –æ—Ç —Ä—É–ª–µ—Ç–æ–∫
                statusMessage.textContent = `–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ ${amount}x ${CASES[caseId].name}...`;

                setTimeout(() => {
                    completeCaseOpening(winningItems);
                }, 500); 
            }

            // --- –õ–û–ì–ò–ö–ê –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–û–ì–û –û–¢–ö–†–´–¢–ò–Ø (–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø) ---
            function runAnimatedOpening(rollArea, winningItem, isSmall = false, resolve) {
                const itemStrip = rollArea.querySelector('.item-strip');
                
                generateStrip(itemStrip, winningItem, isSmall);
                
                const currentItemWidth = isSmall ? 64 : ITEM_WIDTH; 
                
                const winCard = itemStrip.children[50]; 
                
                // 3. –†–∞—Å—á–µ—Ç —Å–º–µ—â–µ–Ω–∏—è
                const rollAreaRect = rollArea.getBoundingClientRect();
                const rollAreaCenter = rollAreaRect.width / 2;
                const targetOffset = winCard.offsetLeft + (currentItemWidth / 2);
                const randomOffset = Math.random() * 20 - 10; 
                const finalOffset = rollAreaCenter - targetOffset + randomOffset;
                
                // –®–∞–≥ A: –°–±—Ä–æ—Å transition –∏ transform
                itemStrip.classList.remove('rolling-animate'); 
                itemStrip.style.transform = 'translateX(0px)';
                
                // –®–∞–≥ B: –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å –º–∞–ª–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(() => {
                    itemStrip.classList.add('rolling-animate'); 
                    itemStrip.style.transform = `translateX(${finalOffset}px)`;
                }, 10); 
                
                // 5. –û–∫–æ–Ω—á–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    rollArea.classList.add('win-flash'); 
                    
                    setTimeout(() => {
                        itemStrip.classList.remove('rolling-animate'); 
                        rollArea.classList.remove('win-flash');
                        
                        if (resolve) {
                             resolve(); 
                        } else {
                            completeCaseOpening([winningItem]);
                        }
                    }, FINAL_PAUSE_DURATION); 

                }, ANIMATION_DURATION); 
            }
            
            // --- –ó–ê–í–ï–†–®–ï–ù–ò–ï –û–¢–ö–†–´–¢–ò–Ø (–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø) ---
            function completeCaseOpening(winningItems) {
                document.querySelectorAll('.open-case-btn').forEach(btn => btn.disabled = false);
                
                // –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                let totalSell = 0;
                let notificationMessage = '';
                
                if (winningItems.length === 1) {
                    const item = winningItems[0];
                    
                    // --- –õ–û–ì–ò–ö–ê "–í–°–Å –ò–õ–ò –ù–ò–ß–ï–ì–û" ---
                    if (CURRENT_CASE_ID === 'risk' && item.name === "–î–∂–µ–∫–ø–æ—Ç (x5 –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤)") {
                        const jackpotItems = [];
                        for(let i=0; i<5; i++) {
                            // –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ê—Ä—Ç–µ—Ñ–∞–∫—Ç
                            const bonusItem = getItemFullData(ALL_ITEMS.find(i => i.id === 5)); 
                            jackpotItems.push({ ...bonusItem, uniqueId: Date.now() + Math.random() + i });
                        }
                        
                        INVENTORY.push(...jackpotItems);
                        statusMessage.innerHTML = `<span style="color: var(--ultra-color); font-weight: bold;">!!! –î–ñ–ï–ö–ü–û–¢ !!!</span> –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 5 –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤!`;
                        showNotification(`!!! –î–ñ–ï–ö–ü–û–¢ !!! –í—ã–∏–≥—Ä–∞–Ω–æ 5 –õ–µ–≥–µ–Ω–¥!`, 'success', 5000);

                    } else if (CURRENT_CASE_ID === 'risk' && item.name === "–ü—É—Å—Ç–æ–π –§–∞–Ω—Ç–æ–º") {
                        statusMessage.innerHTML = `<span style="color: var(--sell-base); font-weight: bold;">–ü–†–û–ò–ì–†–´–®!</span> –í—ã–ø–∞–ª ${item.name} - –ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ.`;
                        showNotification(`–ü–†–û–ò–ì–†–´–®: –ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ.`, 'error', 4000);
                    
                    } else { // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–µ–π—Å
                        notificationMessage = `üéâ –í–´–ò–ì–†–´–®: ${item.name}`;
                        statusMessage.innerHTML = `**–í–´–ò–ì–†–´–®!** –í—ã–ø–∞–ª: <span style="font-weight: bold; color: ${item.class === 'ultra' ? 'var(--ultra-color)' : item.class === 'legendary' ? 'var(--legendary-color)' : item.class === 'rare' || item.class === 'epic' ? 'var(--rare-color)' : 'white'};">${item.name}</span>!`;
                        INVENTORY.push({ ...item, uniqueId: Date.now() + Math.random() });
                        showNotification(notificationMessage, 'success', 4000);
                    }
                    // --- –ö–û–ù–ï–¶ –õ–û–ì–ò–ö–ò "–í–°–Å –ò–õ–ò –ù–ò–ß–ï–ì–û" ---
                
                } else {
                    // –ü–∞—á–∫–∞
                    winningItems.forEach(item => {
                         totalSell += item.sell;
                         INVENTORY.push({ ...item, uniqueId: Date.now() + Math.random() });
                    });
                    notificationMessage = `üéâ –í—ã–ø–∞–ª–æ ${winningItems.length} –ø—Ä–µ–¥–º–µ—Ç–æ–≤.`;
                    statusMessage.innerHTML = `**–ò–¢–û–ì x${winningItems.length}:** –í—ã–ø–∞–ª–æ ${winningItems.length} –ø—Ä–µ–¥–º–µ—Ç–æ–≤. –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span style="color: var(--rare-color);">${totalSell} üíé</span>.`;
                    
                    rollAreaContainer.innerHTML = `<h3 style="color: var(--rare-color);">–û—Ç–∫—Ä—ã—Ç–æ ${winningItems.length} –∫–µ–π—Å–æ–≤! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!</h3>`;
                    showNotification(notificationMessage, 'success', 5000);
                }
                
                renderInventory();
                saveUserData(balance, INVENTORY); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
                if (CURRENT_CASE_ID) {
                    const rollArea = createRollAreaElement(CURRENT_CASE_ID, false);
                    rollAreaContainer.innerHTML = '';
                    rollAreaContainer.appendChild(rollArea);
                    generateStrip(rollArea.querySelector('.item-strip'), getRandomItem(CURRENT_CASE_ID), false);
                }
            }

            // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
            
            sellAllBtn.addEventListener('click', sellAllItems);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –¥–ª—è –ª–æ–±–±–∏
            document.querySelectorAll('.case-lobby-card').forEach(card => {
                card.addEventListener('click', () => renderCaseDetails(card.dataset.caseId));
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–º –≤–∏–¥–µ
            detailOpenButtons.forEach(button => {
                button.addEventListener('click', handleOpenCase);
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –∏ –õ–æ–≥–æ—Ç–∏–ø–∞
            backToLobbyBtn.addEventListener('click', goToLobby);
            mainLogo.addEventListener('click', goToLobby);
            
            // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            addBalanceBtn.addEventListener('click', () => {
                balance += 500;
                updateBalance();
                showNotification("–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω (+500 üíé)", 'success');
            });
            
            // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            async function initialize() {
                const userData = await loadUserData();
                balance = userData.balance;
                INVENTORY.push(...userData.inventory);
                
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const targetTabId = button.dataset.tab;
                        tabContents.forEach(content => content.classList.remove('visible'));
                        setTimeout(() => {
                            tabContents.forEach(content => content.classList.remove('active'));
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            button.classList.add('active');
                            const targetContent = document.getElementById(targetTabId);
                            targetContent.classList.add('active');
                            setTimeout(() => { targetContent.classList.add('visible'); }, 50);
                        }, 400); 
                    });
                });
                
                // --- –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –ê–ö–¢–ò–í–ê–¶–ò–Ø –ü–ï–†–í–û–ô –í–ö–õ–ê–î–ö–ò –ò –õ–û–ë–ë–ò ---
                const caseTab = document.getElementById('cases');
                const caseTabButton = document.querySelector('.tab-button[data-tab="cases"]');
                
                caseTab.classList.add('active');
                caseTab.classList.add('visible');
                caseTabButton.classList.add('active');
                caseLobbyView.classList.add('active'); 
                caseLobbyView.classList.add('visible'); 
                
                updateBalance();
                renderInventory();
                document.body.classList.add('loaded');

                // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞ (–∏–∑–±–µ–≥–∞–µ–º –æ—à–∏–±–æ–∫)
                const dummyRollArea = createRollAreaElement('basic', false);
                document.body.appendChild(dummyRollArea);
                generateStrip(dummyRollArea.querySelector('.item-strip'), getRandomItem('basic'), false);
                document.body.removeChild(dummyRollArea);
            }
            
            initialize();
        });
    </script>
</body>
</html>
