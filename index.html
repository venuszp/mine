<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–°–∞–ø—ë—Ä 1win - –º–µ—Ö–∞–Ω–∏–∫–∞ –∫–∞–∑–∏–Ω–æ</title>
<style>
  /* (—Ç–æ—Ç –∂–µ CSS, —á—Ç–æ –∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ ‚Äî –Ω–µ –º–µ–Ω—è–ª—Å—è) */
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  body {
    margin: 0; padding: 0;
    background: #121b2f;
    color: #cbd5e1;
    font-family: 'Orbitron', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    user-select: none;
  }
  #balance {
    margin: 20px 0;
    font-size: 1.8rem;
    color: #60a5fa;
    text-shadow: 0 0 6px #2563eb;
  }
  #levelInfo {
    margin-bottom: 12px;
    font-size: 1.5rem;
    color: #a5b4fc;
    display: flex;
    align-items: center;
    gap: 8px;
    user-select: none;
  }
  #multiplier {
    font-weight: 900;
    font-size: 1.8rem;
    color: #facc15;
    text-shadow: 0 0 6px #eab308;
  }
  #arrow {
    width: 20px;
    height: 20px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #facc15;
    animation: bounce 1.2s infinite;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
  #betContainer {
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
  }
  #betInput {
    font-size: 1.3rem;
    padding: 10px 14px;
    border-radius: 12px;
    border: none;
    width: 160px;
    text-align: center;
    font-weight: 700;
    box-shadow: 0 0 15px #2563eb;
    color: #121b2f;
    user-select: text;
  }
  #startBtn, #takeBtn {
    background: #10b981;
    border: none;
    color: white;
    font-weight: 700;
    font-size: 1.4rem;
    padding: 12px 40px;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 0 15px #10b981;
    transition: background 0.3s, opacity 1s ease;
  }
  #startBtn:disabled {
    background: #065f46;
    cursor: not-allowed;
    box-shadow: none;
  }
  #startBtn:hover:not(:disabled), #takeBtn:hover {
    background: #059669;
    box-shadow: 0 0 25px #059669;
  }
  #takeBtn.hidden, #startBtn.hidden, #betContainer.hidden {
    opacity: 0;
    pointer-events: none;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(3, 60px);
    grid-template-rows: repeat(10, 60px);
    gap: 8px;
    background: #1e293b;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 0 20px #2563eb;
    position: relative;
    user-select: none;
    margin-bottom: 20px;
  }
  .cell {
    width: 60px;
    height: 60px;
    background: #334155;
    border-radius: 10px;
    box-shadow:
      inset 0 2px 5px rgba(255,255,255,0.15),
      0 2px 8px rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2.2rem;
    font-weight: 900;
    color: transparent;
    cursor: pointer;
    position: relative;
    transition: background 0.3s, color 0.3s;
  }
  .cell:hover:not(.opened):not(.flagged):not(.disabled) {
    background: #3b82f6;
    box-shadow: 0 0 12px #3b82f6;
  }
  .cell.opened {
    background: #e0e7ff;
    color: #1e293b;
    cursor: default;
    box-shadow: inset 0 0 14px #2563eb;
  }
  .cell.mine {
    background: #dc2626;
    color: #fef3f3;
    box-shadow: 0 0 20px #dc2626;
    animation: pulseRed 1.2s infinite alternate;
  }
  @keyframes pulseRed {
    0% { box-shadow: 0 0 15px #dc2626; }
    100% { box-shadow: 0 0 25px #f87171; }
  }
  @keyframes greenGlow {
    0% {
      background-color: #e0e7ff;
      box-shadow: inset 0 0 5px #22c55e;
      color: #166534;
    }
    50% {
      background-color: #d1fae5;
      box-shadow: inset 0 0 20px #22c55e;
      color: #14532d;
    }
    100% {
      background-color: #e0e7ff;
      box-shadow: inset 0 0 5px #22c55e;
      color: #166534;
    }
  }
  .cell.correct {
    animation: greenGlow 2s ease-in-out infinite;
  }
  #message {
    font-size: 2rem;
    font-weight: 900;
    min-height: 36px;
    color: #ef4444;
    text-shadow: 0 0 15px #dc2626;
    margin-bottom: 10px;
    opacity: 1;
    transition: opacity 1.5s ease;
  }
  #message.hidden {
    opacity: 0;
  }
</style>
</head>
<body>

  <div id="balance">–ë–∞–ª–∞–Ω—Å: $5,000,000</div>

  <div id="levelInfo" style="display:none;">
    <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
    <div id="arrow"></div>
    <div>–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="multiplier">x2</span></div>
  </div>

  <div id="betContainer">
    <input id="betInput" type="number" min="1" max="1000000" step="1" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É (USD)" />
    <button id="startBtn" disabled>–ù–∞—á–∞—Ç—å</button>
  </div>

  <div id="board" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ —Å–∞–ø—ë—Ä–∞" role="grid" style="display:none;"></div>

  <button id="takeBtn" class="hidden">–ó–∞–±—Ä–∞—Ç—å</button>

  <div id="message" class="hidden" role="alert"></div>

<script>
  const ROWS = 10;
  const COLS = 3;

  let balance = 5000000;
  let bet = null;
  let board = [];
  let minePositions = [];
  let openedCount = 0;
  let gameOver = false;
  let sessionEarned = 0;
  let level = 1;

  const balanceEl = document.getElementById('balance');
  const betInput = document.getElementById('betInput');
  const startBtn = document.getElementById('startBtn');
  const boardEl = document.getElementById('board');
  const takeBtn = document.getElementById('takeBtn');
  const messageEl = document.getElementById('message');
  const betContainer = document.getElementById('betContainer');
  const levelInfo = document.getElementById('levelInfo');
  const levelEl = document.getElementById('level');
  const multiplierEl = document.getElementById('multiplier');
  const arrowEl = document.getElementById('arrow');

  function formatUSD(amount) {
    return amount.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 });
  }

  function updateBalance() {
    balanceEl.textContent = `–ë–∞–ª–∞–Ω—Å: ${formatUSD(balance)}`;
  }

  function updateBalanceWithSession() {
    balanceEl.textContent = `–ë–∞–ª–∞–Ω—Å: ${formatUSD(balance + sessionEarned)}`;
  }

  function loadBalance() {
    const saved = localStorage.getItem('mines_balance_usd');
    if(saved !== null) {
      const val = parseInt(saved, 10);
      if(!isNaN(val) && val > 0) {
        balance = val;
      } else {
        balance = 5000000;
      }
    } else {
      balance = 5000000;
    }
    updateBalance();
  }

  function saveBalance() {
    localStorage.setItem('mines_balance_usd', balance.toString());
  }

  betInput.addEventListener('input', () => {
    let val = parseInt(betInput.value, 10);
    if(isNaN(val) || val < 1) {
      startBtn.disabled = true;
      bet = null;
      return;
    }
    if(val > balance) val = balance;
    betInput.value = val;
    bet = val;
    startBtn.disabled = val > balance;
    messageEl.classList.add('hidden');
  });

  startBtn.addEventListener('click', () => {
    if(!bet || bet > balance) return;
    startGame();
  });

  function startGame() {
    betContainer.classList.add('hidden');
    startBtn.classList.add('hidden');
    messageEl.classList.add('hidden');

    boardEl.style.display = 'grid';
    takeBtn.classList.add('hidden');
    levelInfo.style.display = 'flex';

    balance -= bet;
    updateBalance();
    sessionEarned = 0;
    level = 1;
    openedCount = 0;
    updateLevelUI();

    createBoard();
    gameOver = false;
  }

  function createBoard() {
    boardEl.innerHTML = '';
    board = [];
    minePositions = [];

    // –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∏–Ω:
    // –ï—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ <= –ø–æ–ª–æ–≤–∏–Ω–∞ –±–∞–ª–∞–Ω—Å–∞ ‚Äî –ù–ï —Å—Ç–∞–≤–∏–º –±–æ–º–±—É –Ω–∞ –ø–µ—Ä–≤–æ–º —É—Ä–æ–≤–Ω–µ
    // –ò–Ω–∞—á–µ —Å—Ç–∞–≤–∏–º –±–æ–º–±—É –Ω–∞ –ø–µ—Ä–≤–æ–π –∫–ª–µ—Ç–∫–µ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–∏–≤)
    const mustLose = bet > balance / 2;

    for(let r=0; r<ROWS; r++) {
      board[r] = [];
      let mineCol;
      if(mustLose && r === 0) {
        // –ø–µ—Ä–≤–∞—è –ª–∏–Ω–∏—è ‚Äî –±–æ–º–±–∞ –≤ —Å–ª—É—á–∞–π–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ (–¥–ª—è —Å–ª–∏–≤–Ω–æ–π –ø–µ—Ä–≤–æ–π –∫–ª–µ—Ç–∫–∏)
        mineCol = Math.floor(Math.random() * COLS);
      } else {
        // –ò–Ω–∞—á–µ –æ–±—ã—á–Ω–æ–µ —Ä–∞–Ω–¥–æ–º–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–æ–º–±—ã –≤ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ
        mineCol = Math.floor(Math.random() * COLS);
      }
      minePositions[r] = mineCol;

      for(let c=0; c<COLS; c++) {
        const cell = {
          row: r,
          col: c,
          mine: c === mineCol,
          opened: false,
          element: document.createElement('div'),
        };
        cell.element.classList.add('cell');
        cell.element.dataset.row = r;
        cell.element.dataset.col = c;

        cell.element.addEventListener('click', () => {
          if(!gameOver) openCell(r, c);
        });

        boardEl.appendChild(cell.element);
        board[r][c] = cell;
      }
    }

    // –ï—Å–ª–∏ mustLose = false, —Ç–æ —É–±–∏—Ä–∞–µ–º –±–æ–º–±—É —Å –ø–µ—Ä–≤–æ–π –ª–∏–Ω–∏–∏, —á—Ç–æ–±—ã –±—ã–ª –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à –Ω–∞ 1 —É—Ä–æ–≤–Ω–µ
    if(!mustLose) {
      const firstRowMine = minePositions[0];
      for(let c=0; c<COLS; c++) {
        board[0][c].mine = false;
        board[0][c].element.classList.remove('mine');
        board[0][c].element.textContent = '';
      }
      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Å—Ç–∞–≤–∏–º –±–æ–º–±—É –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ä—è–¥—É, —á—Ç–æ–±—ã –∏–≥—Ä–∞ –±—ã–ª–∞ —á–µ—Å—Ç–Ω–æ–π, –Ω–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è
      const lastRow = ROWS - 1;
      const lastMineCol = Math.floor(Math.random() * COLS);
      minePositions[lastRow] = lastMineCol;
      board[lastRow][lastMineCol].mine = true;
    }
  }

  function openCell(r, c) {
    // –†–∞–∑—Ä–µ—à–∞–µ–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª–µ—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ (r === level - 1)
    if (r !== level - 1) return;

    const cell = board[r][c];
    if(cell.opened) return;
    cell.opened = true;
    openedCount++;
    cell.element.classList.add('opened');

    if(cell.mine) {
      cell.element.classList.add('mine');
      cell.element.textContent = 'üí£';
      loseGame();
      return;
    }

    cell.element.classList.add('correct');

    level++;
    updateLevelUI();

    // –ú–Ω–æ–∂–∏—Ç–µ–ª—å: –Ω–∞ 1 —É—Ä–æ–≤–Ω–µ = x2, –ø–æ—Ç–æ–º +1
    const multiplier = level === 2 ? 2 : (level - 1);
    sessionEarned = bet * multiplier;
    updateBalanceWithSession();

    messageEl.classList.add('hidden');
    takeBtn.classList.remove('hidden');

    checkWin();
  }

  function updateLevelUI() {
    levelEl.textContent = level;
    // –ú–Ω–æ–∂–∏—Ç–µ–ª—å, —Å x2 –Ω–∞ –ø–µ—Ä–≤–æ–º —É—Ä–æ–≤–Ω–µ:
    const multiplier = level === 1 ? 2 : (level - 1);
    multiplierEl.textContent = `x${multiplier}`;
    arrowEl.style.transform = `translateY(${(level - 1) * 68}px)`;
  }

  function loseGame() {
    gameOver = true;
    sessionEarned = 0;

    messageEl.textContent = '–ñ–∞–ª—å...';
    messageEl.style.color = '#ef4444';
    messageEl.style.textShadow = '0 0 15px #dc2626';
    messageEl.classList.remove('hidden');

    betContainer.classList.remove('hidden');
    startBtn.classList.remove('hidden');
    startBtn.disabled = balance < 1;
    boardEl.style.display = 'none';
    takeBtn.classList.add('hidden');
    levelInfo.style.display = 'none';

    updateBalance();

    saveBalance();
  }

  function checkWin() {
    if(openedCount === ROWS * COLS - ROWS) {
      gameOver = true;

      messageEl.textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏! –í—ã–∏–≥—Ä—ã—à: ${formatUSD(sessionEarned)}`;
      messageEl.style.color = '#60a5fa';
      messageEl.style.textShadow = '0 0 12px #2563eb';
      messageEl.classList.remove('hidden');

      takeBtn.classList.remove('hidden');
      boardEl.style.pointerEvents = 'none';
    }
  }

  takeBtn.addEventListener('click', () => {
    if(sessionEarned > 0) {
      balance += sessionEarned;
      sessionEarned = 0;
      saveBalance();

      boardEl.style.display = 'none';
      takeBtn.classList.add('hidden');
      betContainer.classList.remove('hidden');
      startBtn.classList.remove('hidden');
      startBtn.disabled = balance < 1;
      messageEl.classList.add('hidden');
      levelInfo.style.display = 'none';
      updateBalance();
      gameOver = false;
      bet = null;
      betInput.value = '';
      boardEl.style.pointerEvents = 'auto';
    }
  });

  loadBalance();
</script>
</body>
</html>
